#!/usr/bin/env bash

if [[ -f "${HOME}/opt/bash-completion.d/kubectl" ]]; then
    source "${HOME}/opt/bash-completion.d/kubectl";
    alias __kubectl_last_events="kubectl get event --sort-by=â€™.lastTimestamp"
    alias k=kubectl
    complete -o default -F __start_kubectl k
fi

if command -v kubectl > /dev/null 2>&1; then
  alias __k_logs_deploy="kubectl get deploy --output=custom-columns=:.metadata.name --no-headers | fzf | xargs kubectl kail --deploy"
  alias __k_logs_pods="kubectl get pods --output=custom-columns=:.metadata.name --no-headers | fzf | xargs kubectl kail"
fi

__k8s_enable_prompt_display () {
  export DOTFILES_PROMPT_KUBE=true
}

__k8s_disable_prompt_display () {
  export DOTFILES_PROMPT_KUBE=false
}

__k8s_mktemp_kubeconfig() {
  KUBECONFIG_TMP=$(mktemp)
  cp "${KUBECONFIG:-${HOME}/.kube/config}" "${KUBECONFIG_TMP}"
  export KUBECONFIG="${KUBECONFIG_TMP}"

  printf "Run kubectl for %s\n" $KUBECONFIG

  __k8s_enable_prompt_display
  kubectx
}
